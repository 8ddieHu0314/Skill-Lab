# v0.2.0: Trigger Testing

**Status:** In Progress

## Overview

Test whether skills activate correctly by sending real prompts to LLMs and analyzing execution traces.

## Features

- 4 trigger test types: explicit, implicit, contextual, negative
- CLI-based runtime adapters (Codex CLI, Claude CLI)
- YAML test definition (Given/When/Then DSL or simple format)
- Trace analysis for skill invocation detection

## Trigger Test Types

| Type | Description | Example |
|------|-------------|---------|
| **Explicit** | Skill named directly with $ prefix | `$create-react-app for a todo list` |
| **Implicit** | Describes exact scenario without naming skill | `I need to scaffold a new React application` |
| **Contextual** | Realistic noisy prompt with domain context | `Building a dashboard, can you set up React?` |
| **Negative** | Should NOT trigger (catches false positives) | `How do I fix this useState hook?` |

## CLI Commands

```bash
sklab trigger ./my-skill                    # Run all trigger tests
sklab trigger ./my-skill --runtime codex    # Use Codex CLI
sklab trigger ./my-skill --runtime claude   # Use Claude CLI
sklab trigger ./my-skill --type explicit    # Filter by type
```

## Prerequisites

Trigger testing requires one of:
- **Codex CLI**: Install and configure per OpenAI docs
- **Claude CLI**: Install via `npm install -g @anthropic-ai/claude-code`

## Test Definition Formats

**Given/When/Then DSL** (`tests/scenarios.yaml`):
```yaml
skill: my-skill
scenarios:
  - name: "Direct invocation"
    given:
      - skill: my-skill
      - runtime: codex
    when:
      - prompt: "$my-skill do something"
      - trigger_type: explicit
    then:
      - skill_triggered: true
```

**Simple Format** (`tests/triggers.yaml`):
```yaml
skill: my-skill
test_cases:
  - id: explicit-1
    type: explicit
    prompt: "$my-skill do something"
    expected: trigger
```

## Architecture

```
src/skill_lab/
├── triggers/
│   ├── test_loader.py         # YAML test loading
│   ├── trigger_evaluator.py   # Orchestrates tests
│   └── trace_analyzer.py      # Skill invocation detection
└── runtimes/
    ├── base.py                # RuntimeAdapter ABC
    ├── codex_runtime.py       # Codex CLI adapter
    └── claude_runtime.py      # Claude CLI adapter
```

## Important Note: Execution Environment

**Commands execute on the user's local machine**, not in a sandbox. Skills can:
- Install packages (`npm install`, `pip install`)
- Create, modify, delete files
- Run arbitrary shell commands

Docker sandboxing is planned for v0.4.0.

## Deliverables

- [x] TriggerTestCase, TriggerResult, TriggerReport models
- [x] YAML test case loader (both formats)
- [x] RuntimeAdapter abstract base class
- [x] Codex CLI runtime adapter
- [x] Claude CLI runtime adapter
- [x] TraceAnalyzer for skill invocation detection
- [x] TriggerEvaluator orchestrator
- [x] CLI command: `sklab trigger`
- [ ] Documentation updates
- [ ] Release to PyPI

## Verification

```bash
# Unit tests
pytest tests/test_triggers.py -v
pytest tests/test_runtimes.py -v

# Manual testing (requires CLI installed)
sklab trigger ./tests/fixtures/skills/testing-features --runtime codex
```
