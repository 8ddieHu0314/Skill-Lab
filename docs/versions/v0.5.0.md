# v0.5.0: API-Based Runtimes

**Status:** Planned

## Overview

Direct API runtimes where skill-lab handles the agent loop internally.

## Problem

CLI-based runtimes require users to:
1. Install Codex CLI or Claude CLI separately
2. Configure authentication for those CLIs
3. Manage CLI versions

## Solution

Built-in API runtimes:
- User provides API key via environment variable
- skill-lab handles the agent loop internally
- Single install: `pip install skill-lab`

## CLI Commands

```bash
# Set API key
export OPENAI_API_KEY=sk-...
export ANTHROPIC_API_KEY=sk-ant-...

# Use API-based runtime
sklab test-triggers ./my-skill --runtime openai-api
sklab test-triggers ./my-skill --runtime anthropic-api

# Auto-detect: prefer API if key present, fallback to CLI
sklab test-triggers ./my-skill --runtime auto
```

## Architecture

```
src/skill_lab/
├── runtimes/
│   ├── openai_api_runtime.py    # OpenAI API + agent loop
│   └── anthropic_api_runtime.py # Anthropic API + agent loop
└── agent/
    ├── loop.py                  # Agent loop implementation
    └── tools.py                 # Tool execution (bash, file ops)
```

## Agent Loop Implementation

```
1. Load skill SKILL.md into system prompt
2. Send user prompt to API
3. If API returns tool_use:
   a. Execute tool locally (or in Docker sandbox)
   b. Send tool result back to API
   c. Repeat from step 3
4. Capture all events as TraceEvent
5. Return trace for analysis
```

## Deliverables

- [ ] OpenAI API runtime adapter
- [ ] Anthropic API runtime adapter
- [ ] Agent loop implementation
- [ ] Tool execution handlers
- [ ] `openai` and `anthropic` as optional dependencies
- [ ] Runtime auto-detection

## Verification

```bash
export ANTHROPIC_API_KEY=sk-ant-...
sklab test-triggers ./my-skill --runtime anthropic-api
```
