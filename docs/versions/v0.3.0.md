# v0.3.0: Trace Analysis

**Status:** Planned

## Overview

YAML-driven trace check system for validating execution behavior.

## Features

- 5 trace check types: command_presence, file_creation, event_sequence, loop_detection, efficiency
- YAML-defined checks per skill
- TraceCheckRegistry with @register_trace_handler decorator

## CLI Commands

```bash
sklab eval-trace ./my-skill --trace ./execution.jsonl
```

## Check Definition

```yaml
# tests/trace_checks.yaml
checks:
  - id: npm-install-ran
    type: command_presence
    pattern: "npm install"

  - id: package-json-created
    type: file_creation
    path: "package.json"

  - id: correct-sequence
    type: event_sequence
    sequence: ["npm init", "npm install", "npm run build"]

  - id: no-excessive-retries
    type: loop_detection
    max_retries: 3

  - id: command-count-limit
    type: efficiency
    max_commands: 20
```

## Architecture

```
src/skill_lab/
├── tracechecks/
│   ├── registry.py             # TraceCheckRegistry
│   ├── trace_check_loader.py   # YAML loader
│   └── handlers/               # Check implementations
│       ├── command_presence.py
│       ├── file_creation.py
│       ├── event_sequence.py
│       ├── loop_detection.py
│       └── efficiency.py
├── parsers/
│   └── trace_parser.py         # JSONL parser
└── evaluators/
    └── trace_evaluator.py      # Orchestrator
```

## Deliverables

- [ ] TraceCheckDefinition, TraceCheckResult, TraceReport models
- [ ] JSONL trace parser
- [ ] TraceCheckRegistry with @register_trace_handler
- [ ] 5 trace check handlers
- [ ] TraceEvaluator orchestrator
- [ ] CLI command: `sklab eval-trace`

## Verification

```bash
pytest tests/test_trace_evaluator.py -v
pytest tests/test_trace_handlers.py -v

sklab eval-trace ./my-skill --trace ./execution.jsonl
```
