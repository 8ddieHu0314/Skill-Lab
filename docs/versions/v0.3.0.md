# v0.3.0: Generate + Path Migration

**Status:** Released

## Overview

Two changes in this release:

1. **`sklab generate` command** — Uses the Anthropic SDK to read a SKILL.md and generate trigger test cases with ~10-12 tests across all 4 types (explicit, implicit, contextual, negative).
2. **Trigger test path migration** — Test files moved from `tests/` to `.skill-lab/tests/` to consolidate all skill-lab artifacts under the `.skill-lab/` directory (traces already live at `.skill-lab/traces/`).

## Features

### `sklab generate` Command

LLM-powered trigger test generation:

```bash
# Generate trigger tests for a skill (requires ANTHROPIC_API_KEY)
sklab generate ./my-skill

# Use a specific model
sklab generate ./my-skill --model claude-sonnet-4-5-20250929

# Overwrite existing triggers.yaml
sklab generate ./my-skill --force
```

- Reads SKILL.md, sends to Anthropic API, generates `.skill-lab/tests/triggers.yaml`
- Default model: `claude-haiku-4-5-20251001` (fast and cheap)
- Model resolution: `--model` flag > `SKLAB_MODEL` env var > default
- Validates generated YAML structure before writing
- Prompts before overwriting existing file (use `--force` to skip)
- Optional dependency: `pip install skill-lab[generate]`

### Path Migration: `.skill-lab/tests/`

Trigger test files now live under `.skill-lab/tests/` instead of `tests/`:

| Before (v0.2.0) | After (v0.3.0) |
|------------------|----------------|
| `tests/triggers.yaml` | `.skill-lab/tests/triggers.yaml` |
| `tests/scenarios.yaml` | `.skill-lab/tests/scenarios.yaml` |

This is a **breaking change** — existing trigger test files must be moved manually.

## Architecture

```
src/skill_lab/
├── triggers/
│   ├── generator.py          # NEW: TriggerGenerator class
│   ├── test_loader.py        # MODIFIED: .skill-lab/tests/ path
│   ├── trace_analyzer.py
│   └── trigger_evaluator.py
├── core/
│   └── exceptions.py         # MODIFIED: Added GenerationError
└── cli.py                    # MODIFIED: Added generate command
```

### TriggerGenerator

- `__init__(model, api_key)` — defaults to `claude-haiku-4-5-20251001`
- `generate(skill_path) -> str` — parses SKILL.md, builds prompt, calls API, validates YAML
- `generate_and_write(skill_path, force) -> Path` — writes to `.skill-lab/tests/triggers.yaml`
- NOT imported in `triggers/__init__.py` — `anthropic` is optional, import is lazy

## Deliverables

- [x] `GenerationError` exception class
- [x] `TriggerGenerator` class with prompt building, API call, YAML validation
- [x] `sklab generate` CLI command with lazy import, model flag, force flag
- [x] Migrate test paths from `tests/` to `.skill-lab/tests/`
- [x] Update test fixtures and assertions
- [x] Unit tests with mocked Anthropic API
- [x] Optional dependency: `pip install skill-lab[generate]`

## Verification

```bash
pip install -e ".[dev,generate]"
pytest tests/ -v
pytest tests/test_generator.py -v
mypy src/
ruff check src/ && ruff format --check src/
```
